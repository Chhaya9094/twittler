<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" type="text/css" href="style.css" />
    <script src="jquery.js"></script>
    <script src="jquery.timeago.js" type="text/javascript"></script>
    <script src="data_generator.js"></script>
</head>

<body>
    <header id="header">
        <h1>Twittler <img src="img/leaf.png" id="icon" /></h1>

    </header>
    <div class="container">
        <div class="sidebar">
            <div id="user">
                <img src="img/user.jpg" id="user-pic" />
                <h3>Emily Coco<br/>@emilymcoco</h3>
                <span id="user-tweets">Tweets</span>
                <span id="following">Following: 4</span>
                <span>Followers: 0</span>
            </div>
            <div id="controls">
                <h3>Controls</h3>
                <form method="post" action="#">
                    <label for="tweet-form">Tweet:</label>
                    <input type="text-area" id="tweet-form" name="tweet-form">
                </form>
                <br/>
                <label for="users-list"><h3>Following:</h3></label>
                <ul id="users-list">
                    <li data-user="sharksforcheap">sharksforcheap</li>
                    <li data-user="shawndrost">shawndrost</li>
                    <li data-user="mracus">mracus</li>
                    <li data-user="douglascalhoun">douglascalhoun</li>
                </ul>
            </div>
        </div>
        <div id="tweets">
            <h2>Tweets</h2>
            <button id="new-tweets" type="button">See New Tweets</button>
            <div id="tweet-container">
            </div>
        </div>
    </div>
    <script>
        $(document).ready(function () {

               var allTweets = function (oneUser) {
                   var index;
                   var tweet;
                    if (oneUser !== 'home') {
                         index = streams.users[oneUser].length - 1;
                         tweet = streams.users[oneUser][index];
                         $('#tweets > h2').text('Tweets from @' + oneUser);
                    } else {
                         index = streams.home.length - 1;
                         tweet = streams.home[index];
                         $('#tweets > h2').text('Tweets');
                    }
                $('#tweet-container').empty();
                while (index >= 0) {
                    var $tweet = $('<div id="individual-tweet"><div id="handle"></div><div id="time"></div><p id="text"></p></div>');

                    $tweet.find('#handle').text('@' + tweet.user).data('tweet-user', tweet.user);
                    $tweet.find('#time').text(jQuery.timeago(tweet.created_at));
                    $tweet.find('#text').text(tweet.message);
                    $tweet.appendTo($('#tweet-container'));

                    index -= 1;
                }
            }
            
            var getTweets = function () {
                $('#tweets > h2').text('Tweets');
                $('#tweet-container').empty();
                var index = streams.home.length - 1;
                while (index >= 0) {
                    var tweet = streams.home[index];
                    var $tweet = $('<div id="individual-tweet"><div id="handle"></div><div id="time"></div><p id="text"></p></div>');
                    $tweet.data('tweet-user', tweet.user);
                    $tweet.find('#handle').text('@' + tweet.user);
                    $tweet.find('#time').text(jQuery.timeago(tweet.created_at));
                    $tweet.find('#text').text(tweet.message);
                    $tweet.appendTo($('#tweet-container'));

                    index -= 1;
                }
            }

            var newTweets = function () {
                    setInterval(function () {
                        newTweetCount = (streams.home.length) - $('#tweet-container > div').length;
                        if (newTweetCount === 1) {
                            $('#new-tweets').text('See ' + newTweetCount + ' New Tweet');
                        } else {
                            $('#new-tweets').text('See ' + newTweetCount + ' New Tweets');
                        }
                    }, 3000);
                
            }

            getTweets();
            newTweets();

            $("#new-tweets").on('click', function () {
                getTweets();
                $('#new-tweets').text('0 New Tweets');
            });

            $("#users-list > li").on('click', function () {
                allTweets($(this).data('user'));
            });

            $("#tweet-container > div").on('click', function () {
                allTweets($(this).data('user'));
            });

        });
    </script>
</body>

</html>
